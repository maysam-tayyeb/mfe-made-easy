<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modal Demo with Design System - Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@19/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@19/umd/react-dom.development.js"></script>
  <style>
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
  <!-- Dev Container Header -->
  <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-2">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-4">
        <span class="text-sm font-semibold text-gray-900 dark:text-gray-100">
          üîß Modal Demo Test with Design System
        </span>
      </div>
      <div class="flex items-center gap-2">
        <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded">
          Design System: Testing
        </span>
      </div>
    </div>
  </div>
  
  <!-- MFE Mount Point -->
  <div id="mfe-root" class="min-h-screen p-6"></div>
  
  <!-- Modal Container -->
  <div id="dev-modal-container"></div>
  
  <!-- Notification Container -->
  <div id="dev-notification-container"></div>
  
  <script type="module">
    // Mock services implementation
    const createMockServices = () => {
      // Mock Modal Service
      const modalService = {
        open: (config) => {
          console.log('[Modal] Open:', config);
          
          const modalContainer = document.getElementById('dev-modal-container');
          const modalId = 'modal-' + Date.now();
          
          const modalWrapper = document.createElement('div');
          modalWrapper.id = modalId;
          modalWrapper.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
          `;
          
          const modalContent = document.createElement('div');
          modalContent.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4';
          modalContent.innerHTML = `
            <div class="p-6">
              <h2 class="text-lg font-semibold mb-4">${config.title}</h2>
              <div class="mb-4">
                ${typeof config.content === 'string' ? config.content : '<div id="modal-react-content"></div>'}
              </div>
              <div class="flex justify-end gap-2">
                ${config.onConfirm ? `
                  <button class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300" onclick="closeModal('${modalId}')">
                    Cancel
                  </button>
                  <button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600" onclick="confirmModal('${modalId}')">
                    Confirm
                  </button>
                ` : `
                  <button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600" onclick="closeModal('${modalId}')">
                    OK
                  </button>
                `}
              </div>
            </div>
          `;
          
          modalWrapper.appendChild(modalContent);
          modalContainer.appendChild(modalWrapper);
          
          // Handle React content
          if (typeof config.content !== 'string') {
            const reactContainer = modalWrapper.querySelector('#modal-react-content');
            if (reactContainer) {
              const root = ReactDOM.createRoot(reactContainer);
              root.render(config.content);
            }
          }
          
          // Store config for callbacks
          window['modal_' + modalId] = config;
          
          modalWrapper.addEventListener('click', (e) => {
            if (e.target === modalWrapper) {
              closeModal(modalId);
            }
          });
        },
        close: () => console.log('[Modal] Close')
      };
      
      // Mock Notification Service
      const notificationService = {
        info: (title, message) => showNotification('info', title, message),
        success: (title, message) => showNotification('success', title, message),
        warning: (title, message) => showNotification('warning', title, message),
        error: (title, message) => showNotification('error', title, message),
      };
      
      // Mock Design System Service with actual components
      const designSystemService = {
        getReactComponents: async () => {
          console.log('[DesignSystem] Loading React components...');
          
          // Return actual React components
          const Card = ({ children, variant = 'default', padding = 'normal' }) => {
            const baseClasses = 'rounded-lg border bg-card text-card-foreground';
            const variantClasses = {
              default: 'shadow-sm',
              elevated: 'shadow-md',
              bordered: 'border-2',
            };
            const paddingClasses = {
              compact: '',
              normal: '',
            };
            
            return React.createElement('div', {
              className: `${baseClasses} ${variantClasses[variant]} ${paddingClasses[padding]}`
            }, children);
          };
          
          const Button = ({ children, onClick, variant = 'default', size = 'md' }) => {
            const baseClasses = 'inline-flex items-center justify-center font-medium rounded-md transition-colors';
            const variantClasses = {
              outline: 'border border-input bg-background hover:bg-accent hover:text-accent-foreground',
              default: 'bg-primary text-primary-foreground hover:bg-primary/90',
              primary: 'bg-blue-500 text-white hover:bg-blue-600',
            };
            const sizeClasses = {
              sm: 'h-8 px-3 text-sm',
              md: 'h-9 px-4 text-sm',
            };
            
            return React.createElement('button', {
              onClick,
              className: `${baseClasses} ${variantClasses[variant] || variantClasses.default} ${sizeClasses[size]}`
            }, children);
          };
          
          return { Card, Button };
        }
      };
      
      return {
        modal: modalService,
        notification: notificationService,
        designSystem: designSystemService,
        logger: console,
        eventBus: {
          emit: (event, data) => console.log('[EventBus] Emit:', event, data),
          on: () => () => {},
        }
      };
    };
    
    // Helper functions for modal
    window.closeModal = (modalId) => {
      const modal = document.getElementById(modalId);
      const config = window['modal_' + modalId];
      if (config && config.onClose) {
        config.onClose();
      }
      if (modal) {
        modal.remove();
      }
      delete window['modal_' + modalId];
    };
    
    window.confirmModal = (modalId) => {
      const config = window['modal_' + modalId];
      if (config && config.onConfirm) {
        config.onConfirm();
      }
      closeModal(modalId);
    };
    
    window.showNotification = (type, title, message) => {
      const container = document.getElementById('dev-notification-container');
      const notificationId = 'notification-' + Date.now();
      
      const notification = document.createElement('div');
      notification.id = notificationId;
      notification.style.cssText = 'margin-bottom: 0.5rem; animation: slideIn 0.3s ease-out;';
      
      const bgColors = {
        info: 'bg-blue-500',
        success: 'bg-green-500',
        warning: 'bg-yellow-500',
        error: 'bg-red-500',
      };
      
      const icons = {
        info: '‚ÑπÔ∏è',
        success: '‚úÖ',
        warning: '‚ö†Ô∏è',
        error: '‚ùå',
      };
      
      notification.className = `${bgColors[type]} text-white px-4 py-3 rounded-lg shadow-lg flex items-start gap-3 max-w-sm`;
      notification.innerHTML = `
        <span class="text-xl">${icons[type]}</span>
        <div class="flex-1">
          <div class="font-semibold">${title}</div>
          ${message ? `<div class="text-sm opacity-90">${message}</div>` : ''}
        </div>
        <button class="text-white hover:text-gray-200" onclick="document.getElementById('${notificationId}').remove()">‚úï</button>
      `;
      
      container.appendChild(notification);
      
      // Auto dismiss after 5 seconds
      setTimeout(() => {
        const elem = document.getElementById(notificationId);
        if (elem) {
          elem.style.animation = 'slideOut 0.3s ease-out';
          setTimeout(() => elem.remove(), 300);
        }
      }, 5000);
    };
    
    // Load and mount the MFE
    const mountMFE = async () => {
      try {
        // Create mock services
        const services = createMockServices();
        
        // Import the App component (we'll use the design system version)
        const response = await fetch('./src/App-DesignSystem.tsx');
        const appCode = await response.text();
        
        // For now, let's create a simplified version inline
        const App = ({ services }) => {
          const [events, setEvents] = React.useState([]);
          const [designComponents, setDesignComponents] = React.useState(null);
          const [designSystemLoaded, setDesignSystemLoaded] = React.useState(false);
          
          React.useEffect(() => {
            const loadDesignSystem = async () => {
              if (services.designSystem) {
                try {
                  const components = await services.designSystem.getReactComponents();
                  setDesignComponents(components);
                  setDesignSystemLoaded(true);
                  console.log('Design system loaded successfully!');
                } catch (error) {
                  console.warn('Design system not available:', error);
                }
              }
            };
            loadDesignSystem();
          }, []);
          
          const addEvent = (event) => {
            setEvents(prev => [...prev.slice(-4), event]);
          };
          
          const handleSimpleAlert = () => {
            addEvent('Opening simple alert');
            services.modal.open({
              title: 'Simple Alert',
              content: 'This is a simple alert modal with design system integration.',
              onClose: () => {
                addEvent('Simple alert closed');
                services.notification.info('Alert Closed', 'The simple alert was dismissed');
              },
            });
          };
          
          const handleConfirmation = () => {
            addEvent('Opening confirmation dialog');
            services.modal.open({
              title: 'Confirm Action',
              content: 'Are you sure you want to proceed? This modal uses the design system.',
              onConfirm: () => {
                addEvent('Action confirmed');
                services.notification.success('Confirmed', 'Action was confirmed successfully');
              },
              onClose: () => {
                addEvent('Action cancelled');
                services.notification.warning('Cancelled', 'Action was cancelled');
              },
            });
          };
          
          const Card = designComponents?.Card || (({ children, variant }) => 
            React.createElement('div', { 
              className: `rounded-lg border ${variant === 'elevated' ? 'shadow-md' : 'shadow-sm'} bg-white` 
            }, children)
          );
          
          const Button = designComponents?.Button || (({ children, onClick, variant }) =>
            React.createElement('button', {
              onClick,
              className: `px-4 py-2 rounded ${variant === 'outline' ? 'border border-gray-300' : 'bg-blue-500 text-white'} hover:opacity-90`
            }, children)
          );
          
          return React.createElement('div', { className: 'space-y-6' },
            React.createElement(Card, { variant: 'elevated' },
              React.createElement('div', { className: 'p-6' },
                React.createElement('h3', { className: 'text-xl font-semibold mb-2' }, 'React 19 Modal Demo with Design System'),
                React.createElement('p', { className: 'text-sm text-gray-600 mb-4' }, `React ${React.version}`),
                
                designSystemLoaded && React.createElement('div', { 
                  className: 'mb-4 p-2 bg-green-50 border border-green-200 rounded text-xs text-green-800' 
                }, '‚úÖ Design System Components Loaded'),
                
                React.createElement('div', { className: 'space-y-3' },
                  React.createElement('p', { className: 'text-sm font-medium' }, 'Test Services with Design System:'),
                  React.createElement('div', { className: 'grid grid-cols-2 gap-2' },
                    React.createElement(Button, { onClick: handleSimpleAlert, variant: 'outline' }, 'Simple Alert'),
                    React.createElement(Button, { onClick: handleConfirmation, variant: 'outline' }, 'Confirmation Dialog'),
                    React.createElement(Button, { 
                      onClick: () => {
                        addEvent('Testing notifications');
                        services.notification.success('Success', 'Design system is working!');
                        setTimeout(() => services.notification.info('Info', 'Components are styled correctly'), 500);
                      }, 
                      variant: 'primary' 
                    }, 'Test Notifications')
                  )
                )
              )
            ),
            
            React.createElement(Card, { variant: 'default' },
              React.createElement('div', { className: 'p-6' },
                React.createElement('p', { className: 'text-sm font-medium mb-2' }, 'Event Log:'),
                React.createElement('div', { className: 'space-y-1 text-xs font-mono' },
                  events.length === 0 
                    ? React.createElement('p', { className: 'text-gray-500' }, 'No events yet. Click a button to start.')
                    : events.map((event, index) => 
                        React.createElement('div', { key: index, className: 'text-gray-600' }, event)
                      )
                )
              )
            )
          );
        };
        
        // Mount the app
        const root = ReactDOM.createRoot(document.getElementById('mfe-root'));
        root.render(React.createElement(App, { services }));
        
        console.log('‚úÖ MFE mounted with design system integration test');
      } catch (error) {
        console.error('Failed to mount MFE:', error);
        document.getElementById('mfe-root').innerHTML = `
          <div class="flex items-center justify-center min-h-screen">
            <div class="text-center">
              <div class="text-red-500 text-4xl mb-4">‚ö†Ô∏è</div>
              <h2 class="text-xl font-semibold mb-2">Failed to load MFE</h2>
              <pre class="text-xs text-left bg-gray-100 p-4 rounded">${error.message}</pre>
            </div>
          </div>
        `;
      }
    };
    
    // Mount on load
    mountMFE();
  </script>
</body>
</html>