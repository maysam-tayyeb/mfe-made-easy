<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design System Test - No Global Pollution</title>
  
  <!-- Design System CSS from served dist -->
  <link rel="stylesheet" href="http://localhost:8080/design-system/design-system.css">
  
  <!-- Base Tailwind for additional utilities -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
  <div class="ds-container">
    <h1 class="ds-h1 mb-6">Design System Test Page</h1>
    <p class="ds-text-muted mb-8">Testing design system with zero global pollution</p>
    
    <!-- Test Cards -->
    <div class="ds-section">
      <h2 class="ds-h2 mb-4">Card Variants</h2>
      <div class="ds-grid-3">
        <div class="ds-card-padded">
          <h3 class="ds-h4">Default Card</h3>
          <p class="ds-text-small ds-text-muted">This is a default card with padding</p>
        </div>
        
        <div class="ds-card-padded ds-card-elevated">
          <h3 class="ds-h4">Elevated Card</h3>
          <p class="ds-text-small ds-text-muted">This card has shadow elevation</p>
        </div>
        
        <div class="ds-card-compact ds-card-interactive">
          <h3 class="ds-h4">Interactive Card</h3>
          <p class="ds-text-small ds-text-muted">Hover over this card</p>
        </div>
      </div>
    </div>
    
    <!-- Test Buttons -->
    <div class="ds-section">
      <h2 class="ds-h2 mb-4">Button Variants</h2>
      <div class="ds-stack-sm">
        <div class="flex gap-2 flex-wrap">
          <button class="ds-button-primary">Primary</button>
          <button class="ds-button-secondary">Secondary</button>
          <button class="ds-button-outline">Outline</button>
          <button class="ds-button-ghost">Ghost</button>
          <button class="ds-button-destructive">Destructive</button>
        </div>
        <div class="flex gap-2 flex-wrap">
          <button class="ds-button-primary ds-button-sm">Small</button>
          <button class="ds-button-primary">Normal</button>
          <button class="ds-button-primary ds-button-lg">Large</button>
        </div>
      </div>
    </div>
    
    <!-- Test Forms -->
    <div class="ds-section">
      <h2 class="ds-h2 mb-4">Form Elements</h2>
      <div class="ds-grid-2">
        <div class="ds-card-padded">
          <div class="ds-stack">
            <div class="ds-form-group">
              <label class="ds-label">Input Field</label>
              <input type="text" class="ds-input" placeholder="Enter text">
            </div>
            <div class="ds-form-group">
              <label class="ds-label">Textarea</label>
              <textarea class="ds-textarea" placeholder="Enter longer text"></textarea>
            </div>
          </div>
        </div>
        
        <div class="ds-card-padded">
          <h4 class="ds-h4 mb-3">Badges</h4>
          <div class="flex gap-2 flex-wrap">
            <span class="ds-badge-default">Default</span>
            <span class="ds-badge-primary">Primary</span>
            <span class="ds-badge-success">Success</span>
            <span class="ds-badge-warning">Warning</span>
            <span class="ds-badge-error">Error</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Test Alerts -->
    <div class="ds-section">
      <h2 class="ds-h2 mb-4">Alert Messages</h2>
      <div class="ds-stack">
        <div class="ds-alert-info">
          <strong>Info:</strong> This is an informational message
        </div>
        <div class="ds-alert-success">
          <strong>Success:</strong> Operation completed successfully
        </div>
        <div class="ds-alert-warning">
          <strong>Warning:</strong> Please review before proceeding
        </div>
        <div class="ds-alert-error">
          <strong>Error:</strong> Something went wrong
        </div>
      </div>
    </div>
    
    <!-- ES Module Test -->
    <div class="ds-section">
      <h2 class="ds-h2 mb-4">ES Module Integration</h2>
      <div class="ds-card-padded">
        <p class="ds-text-small mb-3">Testing explicit ES module import (no globals):</p>
        <div id="token-test" class="p-4 bg-gray-100 rounded font-mono text-xs">
          Loading tokens...
        </div>
      </div>
    </div>
    
    <!-- Global Pollution Check -->
    <div class="ds-section">
      <h2 class="ds-h2 mb-4">Global Pollution Check</h2>
      <div class="ds-card-padded">
        <p class="ds-text-small mb-3">Verifying no global variables were created:</p>
        <div id="global-check" class="p-4 bg-gray-100 rounded font-mono text-xs"></div>
      </div>
    </div>
  </div>
  
  <script type="module">
    // Test ES module import - explicit, no globals
    async function testDesignSystem() {
      const tokenTest = document.getElementById('token-test');
      const globalCheck = document.getElementById('global-check');
      
      try {
        // Explicit import - no window/global access
        const designSystem = await import('http://localhost:8080/design-system/design-system.esm.js');
        
        tokenTest.innerHTML = `
          <div class="text-green-600">✅ ES Module loaded successfully!</div>
          <div class="mt-2">Version: ${designSystem.version}</div>
          <div class="mt-2">Available exports:</div>
          <ul class="mt-1 ml-4">
            ${Object.keys(designSystem).map(key => `<li>• ${key}</li>`).join('')}
          </ul>
        `;
        
        // Verify no global pollution
        const suspiciousGlobals = [];
        const allowedGlobals = new Set([
          'window', 'document', 'navigator', 'location', 'history',
          'console', 'alert', 'confirm', 'prompt', 'setTimeout',
          'setInterval', 'clearTimeout', 'clearInterval', 'fetch',
          'Promise', 'Array', 'Object', 'String', 'Number', 'Boolean',
          'Date', 'Math', 'JSON', 'RegExp', 'Error', 'Map', 'Set',
          'WeakMap', 'WeakSet', 'Symbol', 'Proxy', 'Reflect',
          // Test page specific
          'testDesignSystem'
        ]);
        
        for (const key in window) {
          if (!allowedGlobals.has(key) && !key.startsWith('__') && !key.includes('webkit')) {
            suspiciousGlobals.push(key);
          }
        }
        
        if (suspiciousGlobals.length === 0) {
          globalCheck.innerHTML = '<div class="text-green-600">✅ No global pollution detected! Window is clean.</div>';
        } else {
          globalCheck.innerHTML = `
            <div class="text-yellow-600">⚠️ Found ${suspiciousGlobals.length} non-standard globals:</div>
            <ul class="mt-2">${suspiciousGlobals.slice(0, 10).map(g => `<li>• ${g}</li>`).join('')}</ul>
          `;
        }
        
      } catch (error) {
        tokenTest.innerHTML = `
          <div class="text-red-600">❌ Failed to load ES module</div>
          <div class="mt-2 text-gray-600">${error.message}</div>
          <div class="mt-2 text-gray-500">Make sure serve:mfes is running on port 8080</div>
        `;
      }
    }
    
    // Run test
    testDesignSystem();
  </script>
</body>
</html>